# Render Blueprint for WrzDJ
# https://render.com/docs/blueprint-spec
#
# Deploy: Connect repo to Render and it will auto-detect this file
#
# After deployment, add custom domains:
#   - api service: api.yourdomain.com
#   - web service: app.yourdomain.com
#
# Then update CORS_ORIGINS, PUBLIC_URL, and NEXT_PUBLIC_API_URL
# in Render dashboard to match your domain.

databases:
  - name: wrzdj-db
    databaseName: wrzdj
    user: wrzdj
    plan: free # or starter for production

services:
  # FastAPI Backend
  - type: web
    name: wrzdj-api
    runtime: docker
    dockerfilePath: ./server/Dockerfile
    dockerContext: ./server
    plan: free # or starter for production
    healthCheckPath: /health
    envVars:
      - key: ENV
        value: production
      - key: DATABASE_URL
        fromDatabase:
          name: wrzdj-db
          property: connectionString
      - key: JWT_SECRET
        generateValue: true
      - key: SPOTIFY_CLIENT_ID
        sync: false # Set manually in Render dashboard
      - key: SPOTIFY_CLIENT_SECRET
        sync: false # Set manually in Render dashboard
      - key: CORS_ORIGINS
        value: https://wrzdj-web.onrender.com  # Add your custom domain after setup
      - key: PUBLIC_URL
        value: https://wrzdj-web.onrender.com  # Update to your custom domain
      - key: BOOTSTRAP_ADMIN_USERNAME
        sync: false
      - key: BOOTSTRAP_ADMIN_PASSWORD
        sync: false

  # Next.js Frontend
  - type: web
    name: wrzdj-web
    runtime: docker
    dockerfilePath: ./dashboard/Dockerfile
    dockerContext: ./dashboard
    plan: free # or starter for production
    healthCheckPath: /api/health
    buildFilter:
      paths:
        - dashboard/**
    envVars:
      - key: NEXT_PUBLIC_API_URL
        value: https://wrzdj-api.onrender.com  # Update to your custom domain
