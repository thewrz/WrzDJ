# WrzDJ JSON analytics log format
# Installed to /etc/nginx/conf.d/wrzdj-logging.conf by setup-nginx.sh
#
# This file has no ${VARS} — it is NOT a template.
# It lives in the http{} context via conf.d/ include.
#
# Fields:
#   status, body_bytes_sent, request_time — unquoted (JSON numbers)
#   upstream_response_time — quoted (nginx writes "-" when no upstream)
#
# Parseable by: GoAccess (goaccess.conf), Loki/Promtail, jq, python3 -m json.tool

log_format json_analytics escape=json
    '{'
      '"time":"$time_iso8601",'
      '"host":"$host",'
      '"remote_addr":"$remote_addr",'
      '"request":"$request",'
      '"status":$status,'
      '"body_bytes_sent":$body_bytes_sent,'
      '"request_time":$request_time,'
      '"upstream_response_time":"$upstream_response_time",'
      '"http_referer":"$http_referer",'
      '"http_user_agent":"$http_user_agent",'
      '"ssl_protocol":"$ssl_protocol",'
      '"request_method":"$request_method",'
      '"request_uri":"$request_uri"'
    '}';

# Disable default global access_log — each server block defines its own
access_log off;
