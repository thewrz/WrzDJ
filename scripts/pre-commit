#!/usr/bin/env bash
set -e

# Only run checks if server files are staged
SERVER_FILES=$(git diff --cached --name-only --diff-filter=ACMR -- 'server/*.py' 'server/**/*.py' 2>/dev/null)

if [ -n "$SERVER_FILES" ]; then
    echo "Running backend lint checks..."

    cd server

    .venv/bin/ruff check .
    .venv/bin/ruff format --check .
    .venv/bin/bandit -r app -c pyproject.toml -q

    cd ..

    echo "Backend lint checks passed."
fi
